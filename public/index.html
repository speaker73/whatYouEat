<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset=UTF-8>
    <title>Страница</title>
    <style type=text/css>
    html,
    body {
        height: 100%;
    }
    
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column; 
    }
    .button{
    	background-color: #3b9272;
    	border-radius: 3px;
    	border-width: 0;
    	width: 10em;
    	height: 2.4em;
    	color: #fff;
    	font-family: monospace;
    	font-weight: 700;
    }
    .save{
		background-color: #3b5e92;
    }
    .restorans-text-area{

    	min-width: 960px
    }
    .history > h2 {
    	color:#999;
    }
    .history > ul > li {
    	color:#999;
    	list-style-type: upper-roman;
    }
    .history {
    	position: absolute;
    	top:0;
    	right:130px;
    }
    </style>
</head>

<body>
	<div><textarea class="restorans-text-area" id="restorans" type="text" name="restorans"></textarea> </div>
    <h1>Пока ничего не выбрано</h1>
	<div>
		<input type="submit" name="randomyze" id="press" class="button" value="Выбрать">
	<input type="submit" name="save" id="save" class="button save" value="Сохранить">

	</div>
	<div class="history">
		<h2>History</h2>
		<ul>
			
		</ul>
	</div>
    <script type="text/javascript" src='./node_modules/jquery/dist/jquery.min.js'></script>

    <script type=text/javascript>
   		$.getJSON('https://api.ipify.org?format=json', function(data){
    		console.log('Your ip is =>',data.ip);
    		ip = data.ip;
		});

   		function choiseRestoran(){
   			const number = Math.floor(Math.random() * (($('#restorans').val().split(', ').length-1) - 0 + 1)) + 0;
   			return $('#restorans').val().split(', ')[number]
   		}
   		// choise
    	$('#press').on('click', ()=>{
    		$('h1').text(choiseRestoran());
    		$('.history > ul').append('<li>'+choiseRestoran()+'; ip : '+ ip +'</li>');

    		$.get("history", { message: choiseRestoran()+'; ip : '+ ip }, (data, status) => {
        		console.log(data, status);
    		})
    	});

    	//save 
    	$('#save').on('click', ()=>{
    		const sendData =  $('#restorans').val();
    		console.log(sendData);
    		$.get("update", { message: sendData }, (data, status) => {
        		console.log(data, status);
    		})
    	});

    	//get index
    	$(document).ready(function(){
    
			$.get("restorans", (data, status) => {
        		console.log(data, status);
        		const dataX = JSON.parse(data)
        		$('#restorans').val(dataX.data.join(', ')  );
        		//$('.history > ul').each(JSON.parse(data.history) );
        		dataX.history.forEach((item)=>{
        			$('.history > ul').append("<li>"+item+"</li>");
        		});
    		});

		});

    </script>

</body>

</html>
